<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <title>Falppy Bird</title>

    <!-- Prefetch resources -->
    <link rel="prefetch" href="https://pygame-web.github.io/archives/0.9/pythonrc.py">
    <link rel="prefetch" href="https://pygame-web.github.io/archives/0.9/vt/xterm.js">
    <link rel="prefetch" href="https://pygame-web.github.io/archives/0.9/vt/xterm-addon-image.js">
    <link rel="icon" type="image/png" href="favicon.png" sizes="16x16">

    <style>
        body {
            margin: 0; padding: 0;
            font-family: Arial, sans-serif;
            background-color: powderblue;
            overflow: hidden;
        }

        canvas.emscripten {
            border: 0;
            background-color: transparent;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            touch-action: none; /* prevent scrolling */
        }

        #tap-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            z-index: 10;
            user-select: none;
            cursor: pointer;
        }

        #status {
            display: inline-block;
            margin: 20px 0 0 30px;
            font-weight: bold;
            color: rgb(120,120,120);
        }

        #progress {
            height: 20px;
            width: 300px;
        }
    </style>

    <script src="https://pygame-web.github.io/archives/0.9/browserfs.min.js"></script>
</head>

<body>
    <!-- Loading Progress -->
    <div id="transfer" align="center">
        <div class="emscripten" id="status">Downloading...</div>
        <div class="emscripten">
            <progress value="0" max="100" id="progress"></progress>
        </div>
    </div>

    <!-- Canvas -->
    <canvas class="emscripten" id="canvas" width="1px" height="1px"
        oncontextmenu="event.preventDefault()" tabindex=1></canvas>

    <!-- Tap to Start Overlay -->
    <div id="tap-overlay">Tap to Start</div>

    <div id="pyconsole">
        <div id="terminal" tabIndex=1 align="left"></div>
    </div>

    <script type="application/javascript">
    // =========================
    // Mobile & Desktop Input Handling
    // =========================
    (function() {
        const canvas = document.getElementById("canvas");
        const overlay = document.getElementById("tap-overlay");

        function triggerJump() {
            if (window.Module && window.Module.PyRun_SimpleString) {
                window.Module.PyRun_SimpleString(
                    "import pygame; pygame.event.post(pygame.event.Event(pygame.KEYDOWN, key=pygame.K_SPACE))"
                );
            }
        }

        // Mobile tap / desktop click
        canvas.addEventListener("touchstart", e => { e.preventDefault(); triggerJump(); }, { passive:false });
        canvas.addEventListener("mousedown", e => { triggerJump(); });

        // Tap to start overlay
        overlay.addEventListener("click", () => {
            overlay.style.display = "none";
            triggerJump();
        });
    })();

    // Prevent scrolling for arrow keys and space
    window.addEventListener("keydown", function(e) {
        if(["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(e.code) > -1) {
            e.preventDefault();
        }
    }, false);

    async function custom_onload(debug_hidden) {
        document.getElementById('pyconsole').hidden = debug_hidden;
        document.getElementById('transfer').hidden = debug_hidden;
    }

    function custom_prerun() { console.log("Pre-run tasks"); }
    function custom_postrun() { console.log("Post-run tasks"); }

    </script>

</body>
</html>
